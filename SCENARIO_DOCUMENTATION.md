# توثيق السيناريو - GPMS Scenario Documentation

تاريخ: 2026-01-01

## السيناريو الكامل لنظام GPMS

### 1. الأدوار والمسؤوليات

#### الطالب (Student)
**الصلاحيات الأساسية:**
- تقديم مقترحات مشاريع خلال نافذة تقديم المقترحات
- تصفح المشاريع المعتمدة والمعلنة
- التسجيل في مشروع متاح (ضمن نافذة التسجيل)
- إدارة المجموعة الطلابية (دعوة/قبول أعضاء)
- تقديم طلبات تغيير (مشرف، مجموعة، مشروع)
- رفع الوثائق والتقارير
- متابعة ملاحظات المشرف والرد عليها
- رؤية المراحل والاجتماعات
- استعراض الدرجات النهائية بعد الاعتماد

**رحلة الطالب النموذجية:**
```
1. تسجيل الدخول
2. [نافذة تقديم مقترحات مفتوحة] → تقديم مقترح مشروع
3. انتظار مراجعة لجنة المشاريع
4. [إذا تطلب تعديلات] → تعديل المقترح وإعادة إرساله
5. [عند اعتماد المشاريع] → تصفح المشاريع المعتمدة
6. [نافذة التسجيل مفتوحة] → التسجيل في مشروع
7. إدارة المجموعة (إضافة أعضاء)
8. رفع الوثائق خلال نافذة التسليم
9. متابعة الملاحظات والمراحل
10. استعراض الدرجة النهائية عند اعتمادها
```

#### المشرف (Supervisor)
**الصلاحيات الأساسية:**
- تقديم مقترحات مشاريع
- استعراض المشاريع المسندة إليه
- معالجة طلبات الإشراف (قبول/رفض)
- إنشاء وإدارة مراحل المشروع
- جدولة وإدارة الاجتماعات
- كتابة ملاحظات للطلاب
- تقييم المشاريع وتسجيل درجات الإشراف
- استعراض درجات الطلاب في مشاريعه

**رحلة المشرف النموذجية:**
```
1. تسجيل الدخول
2. [نافذة تقديم مقترحات] → تقديم مقترحات مشاريع
3. [عند إسناد مشروع] → قبول/رفض طلب الإشراف
4. إنشاء مراحل للمشروع
5. جدولة اجتماعات دورية
6. كتابة ملاحظات وملاحظات
7. مراجعة الوثائق المسلمة
8. [نافذة تقييم المشرف] → تسجيل درجات الإشراف
9. استعراض الدرجات النهائية
```

#### لجنة المناقشة (Discussion Committee)
**الصلاحيات الأساسية:**
- استعراض المشاريع المسندة لهم
- مراجعة وثائق وتقارير المشروع
- تسجيل درجات المناقشة (منفصلة عن المشرف)

**رحلة لجنة المناقشة النموذجية:**
```
1. تسجيل الدخول
2. استعراض المشاريع المسندة
3. مراجعة الوثائق والتقارير
4. [نافذة تقييم لجنة المناقشة] → حضور المناقشة
5. تسجيل درجات المناقشة (متضمنة أعضاء اللجنة)
```

#### لجنة المشاريع (Projects Committee)
**الصلاحيات الأساسية:**
- إدارة النوافذ الزمنية (إنشاء/تحديث/تفعيل/إيقاف)
- مراجعة المقترحات (اعتماد/رفض/طلب تعديل)
- إعلان المشاريع المعتمدة للتسجيل
- تعيين المشرفين للمشاريع
- معالجة طلبات التغيير من الطلاب
- توزيع لجان المناقشة على المشاريع
- اعتماد الدرجات النهائية
- إصدار التقارير الإحصائية

**رحلة لجنة المشاريع النموذجية:**
```
1. تسجيل الدخول
2. إعلان فترة تقديم المقترحات (إنشاء نافذة زمنية)
3. [عند انتهاء الفترة] → مراجعة المقترحات المقدمة
4. اتخاذ قرارات (اعتماد/رفض/طلب تعديل)
5. تعيين مشرفين للمشاريع المعتمدة
6. إعلان فترة التسجيل
7. إعلان المشاريع المعتمدة للطلاب
8. [بعد التسجيل] → معالجة طلبات التغيير
9. توزيع لجان المناقشة
10. [بعد التقييمات] → اعتماد الدرجات النهائية
11. إصدار تقارير إحصائية
```

### 2. النوافذ الزمنية (Time Windows)

#### النوافذ المدعومة:
1. **proposal_submission** - تقديم المقترحات
   - يُسمح للطلاب والمشرفين بتقديم مقترحات جديدة
   
2. **proposal_review** - مراجعة المقترحات
   - لجنة المشاريع تراجع وتعتمد/ترفض
   
3. **project_registration** - التسجيل في المشاريع
   - الطلاب يسجلون في المشاريع المعلنة
   
4. **project_execution** - تنفيذ المشاريع
   - فترة العمل على المشروع
   
5. **deliverable_submission** - تسليم المخرجات
   - الطلاب يرفعون الوثائق والتقارير
   
6. **supervisor_evaluation** - تقييم المشرف
   - المشرفون يسجلون درجات الإشراف
   
7. **discussion_evaluation** - تقييم لجنة المناقشة
   - لجان المناقشة تسجل درجات المناقشة
   
8. **grade_approval** - اعتماد الدرجات
   - لجنة المشاريع تعتمد الدرجات النهائية

#### خصائص النوافذ:
- **متعددة ومتداخلة**: يمكن أن تكون عدة نوافذ نشطة في نفس الوقت
- **قابلة للتحكم**: لجنة المشاريع تتحكم بتواريخ البداية والنهاية
- **إجبارية**: تُطبق على API endpoints (ماعدا لجنة المشاريع)
- **مرئية**: الواجهة تعرض حالة النوافذ للمستخدمين

### 3. حالات الكيانات (Entity States)

#### Proposal (المقترح):
```
[draft] → (submit) → [pending_review]
[pending_review] → (committee reviews) → [approved] | [rejected] | [requires_modification]
[requires_modification] → (resubmit) → [pending_review]
[approved] → (becomes Project)
```

#### Project (المشروع):
```
[draft] → (committee action) → [announced]
[announced] → (open registration) → [available_for_registration]
[available_for_registration] → (student registers) → [in_progress]
[in_progress] → (complete evaluation) → [completed]
[completed] → (archive) → [archived]
```

#### Request (طلب التغيير):
```
[pending] → (supervisor reviews) → [supervisor_approved] | [supervisor_rejected]
[supervisor_approved] → (committee reviews) → [committee_approved] | [committee_rejected]
[pending] → (student cancels) → [cancelled]
```

### 4. نموذج الدرجات (Grading Model)

#### هيكل الدرجة:
```json
{
  "project_id": 1,
  "student_id": 5,
  "supervisor_grade": {
    "score": 85,
    "maxScore": 100,
    "criteria": [
      {"name": "التزام بالمواعيد", "score": 20, "maxScore": 20},
      {"name": "جودة التنفيذ", "score": 35, "maxScore": 40},
      {"name": "الابتكار", "score": 15, "maxScore": 20},
      {"name": "التعاون", "score": 15, "maxScore": 20}
    ],
    "comments": "أداء جيد مع بعض نقاط التحسين"
  },
  "committee_grade": {
    "score": 90,
    "maxScore": 100,
    "criteria": [
      {"name": "العرض التقديمي", "score": 28, "maxScore": 30},
      {"name": "الإجابة على الأسئلة", "score": 25, "maxScore": 30},
      {"name": "الوثائق", "score": 22, "maxScore": 25},
      {"name": "المنتج النهائي", "score": 15, "maxScore": 15}
    ],
    "comments": "مناقشة ممتازة",
    "committee_members": [12, 15, 18]
  },
  "final_grade": 87.5,
  "is_approved": true,
  "approved_at": "2026-01-15T10:00:00Z",
  "approved_by": 3
}
```

#### احتساب الدرجة النهائية:
- **معادلة بسيطة**: `(supervisor_grade + committee_grade) / 2`
- **قابلة للتخصيص**: يمكن تطبيق أوزان مختلفة حسب السياسة

#### الصلاحيات:
- المشرف: يسجل `supervisor_grade` فقط
- لجنة المناقشة: تسجل `committee_grade` فقط
- لجنة المشاريع: تعتمد وتحسب `final_grade`
- الطالب: يرى النتيجة بعد `is_approved = true`

### 5. الصلاحيات والأمان (Permissions & Security)

#### Policies المطبقة:
1. **ProposalPolicy**: 
   - view: الصاحب أو لجنة المشاريع
   - update: الصاحب (إذا pending أو requires_modification)
   - delete: الصاحب (إذا pending فقط)

2. **ProjectPolicy**:
   - view: حسب الدور والإسناد
   - create: لجنة المشاريع فقط
   - update: لجنة المشاريع أو المشرف المسؤول
   - register: طلاب (مع شروط)

3. **GradePolicy**:
   - view: الطالب، المشرف، اللجنة، لجنة المشاريع
   - updateSupervisorGrade: المشرف المسؤول فقط
   - updateCommitteeGrade: عضو لجنة المناقشة المُسند فقط
   - approve: لجنة المشاريع فقط

4. **ProjectRequestPolicy**:
   - create: طلاب فقط
   - cancel: الطالب صاحب الطلب
   - supervisorApprove: المشرف المسؤول
   - committeeApprove: لجنة المشاريع

#### Middleware:
- `auth:sanctum`: جميع المسارات المحمية
- `role:{role}`: فحص الدور
- `window:{type}`: فحص النافذة الزمنية

### 6. التدفقات الرئيسية (Main Flows)

#### تدفق المقترح → مشروع:
```
1. طالب/مشرف يقدم مقترح [proposal_submission window]
2. لجنة المشاريع تستلم إشعار
3. لجنة المشاريع تراجع المقترح
4. القرار: اعتماد | رفض | طلب تعديل
5. [إذا اعتمد] → يتحول إلى Project (status: approved)
6. لجنة المشاريع تعيّن مشرف
7. لجنة المشاريع تُعلن المشروع (status: available_for_registration)
```

#### تدفق التسجيل في مشروع:
```
1. طالب يتصفح المشاريع المتاحة
2. [project_registration window مفتوحة]
3. طالب يتقدم للتسجيل
4. نظام يفحص:
   - هل المشروع متاح؟
   - هل الطالب مسجل مسبقاً؟
   - هل يوجد مكان متاح؟
5. [إذا صح] → تسجيل مؤكد
6. Project.status → in_progress
```

#### تدفق التقييم:
```
1. [supervisor_evaluation window] → مشرف يسجل درجات الإشراف
2. [discussion_evaluation window] → لجنة المناقشة تسجل درجات المناقشة
3. [grade_approval window] → لجنة المشاريع تراجع
4. لجنة المشاريع تعتمد (is_approved = true)
5. نظام يحسب final_grade
6. طالب يرى الدرجة النهائية
```

### 7. الإشعارات (Notifications)

#### أحداث تُرسل إشعارات:
- تقديم مقترح جديد → لجنة المشاريع
- اعتماد/رفض مقترح → الصاحب
- طلب تعديل مقترح → الصاحب
- إعلان مشاريع جديدة → جميع الطلاب
- تسجيل طالب في مشروع → المشرف
- رفع وثيقة جديدة → المشرف
- ملاحظة جديدة من المشرف → الطلاب
- طلب تغيير جديد → المشرف ولجنة المشاريع
- قرار في طلب تغيير → الطالب
- إسناد لجنة مناقشة → أعضاء اللجنة
- اعتماد درجة نهائية → الطالب

### 8. التقارير (Reports)

#### تقارير لجنة المشاريع:
- إجماليات المقترحات (معتمد/مرفوض/قيد المراجعة)
- إجماليات المشاريع (حسب الحالة)
- إحصائيات التسجيل (طلاب مسجلين/غير مسجلين)
- متوسطات الدرجات (حسب المشرف/القسم/الفصل)
- توزيع الدرجات
- نسبة الإكمال
- مشاريع متأخرة/محفوفة بالمخاطر

### 9. أفضل الممارسات (Best Practices)

#### للمطورين:
1. استخدم `authorize()` في Controllers للإجراءات الحساسة
2. تحقق من النافذة الزمنية قبل العمليات المقيدة
3. استخدم Transactions للعمليات المركبة
4. أرسل إشعارات للأطراف المعنية
5. سجل الأحداث المهمة (audit log)
6. تحقق من صحة البيانات بـ validation rules
7. استخدم Resource classes لتنسيق الاستجابات
8. تعامل مع الأخطاء بشكل واضح ومفيد

#### للمستخدمين:
1. راقب النوافذ الزمنية النشطة
2. قدم المقترحات مبكراً
3. راجع الملاحظات والرد عليها بسرعة
4. التزم بالمواعيد النهائية
5. تواصل مع المشرف بانتظام
6. احتفظ بنسخ احتياطية من الوثائق

## الخلاصة

هذا السيناريو يوفر نظام إدارة متكامل لمشاريع التخرج مع:
- ✅ أدوار واضحة ومحددة
- ✅ نوافذ زمنية قابلة للتكوين
- ✅ حالات واضحة للكيانات
- ✅ نموذج تقييم مزدوج (مشرف + لجنة)
- ✅ صلاحيات محكمة
- ✅ تدفقات منطقية
- ✅ إشعارات تلقائية
- ✅ تقارير شاملة
